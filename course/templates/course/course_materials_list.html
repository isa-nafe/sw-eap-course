{% extends 'course/base.html' %}
{% load humanize %}
{% block title %}Course Materials - {{ block.super }}{% endblock %}

{% block content %}
  <h2 class="mb-4">Course Materials</h2>

  {% if payment_required %}
    <div class="alert alert-info" role="alert">
        <h4 class="alert-heading">Access Restricted</h4>
        <p>These course materials are available upon enrollment. Please purchase the course to gain access.</p>
        <hr>
        <form action="{% url 'course:create_checkout_session' %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="btn btn-success">Enroll Now for ${{ course_price_dollars }}</button>
        </form>
        <p class="mt-2"><a href="{% url 'course:dashboard' %}" class="btn btn-secondary btn-sm">Back to Dashboard</a></p>
    </div>
  {% elif materials %}
    <div class="table-responsive">
      <table class="table table-striped table-hover table-bordered">
        <thead class="table-dark">
          <tr>
            <th scope="col">Title</th>
            <th scope="col">Type</th>
            <th scope="col">Description</th>
            <th scope="col">Uploaded</th>
            <th scope="col">Instructor</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for material in materials %}
            <tr>
              <td>{{ material.title }}</td>
              <td>{{ material.get_material_type_display }}</td>
              <td>{{ material.description|truncatewords:15|default:"-" }}</td>
              <td>{{ material.uploaded_at|naturaltime }}</td>
              <td>{{ material.uploaded_by.username|default:"N/A" }}</td>
              <td>
                {% if material.file %}
                  <a href="{% url 'course:serve_protected_material' material.id %}" class="btn btn-primary btn-sm">Download</a>
                {% else %}
                  <span class="text-muted">No file</span>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" class="text-center">No course materials have been uploaded yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-secondary" role="alert">
      No course materials have been uploaded yet or are available to you. Check back soon!
    </div>
  {% endif %}
{% endblock %}
